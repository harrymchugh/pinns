Bootstrap: docker
From: ubuntu:latest

%files
    entrypoint.sh /entrypoint.sh

%post
    DEBIAN_FRONTEND=noninteractive

    apt-get update
    apt-get -y install --no-install-recommends \
        apt-utils vim-tiny nano-tiny wget ca-certificates rsync \
        passwd libnss-wrapper

    wget -q -O - https://dl.openfoam.com/add-debian-repo.sh | bash
    apt-get update
    apt-get -y install --no-install-recommends openfoam2212-dev
    
    apt-get -y install python3 python3-pip
    pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu118

    rm -rf /var/lib/apt/lists/*


%runscript
    source /usr/lib/openfoam/openfoam2212/etc/bashrc
    exec "$@"
